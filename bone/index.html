<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>ASL Vocalizer</title>
    
    <!-- JS -->
    <script src="http://js.leapmotion.com/0.2.0/leap.min.js"></script>
    <script src="js/leaptrainer.min.js"></script>
    <script src="sub-classes/high-resolution-recording.js"></script>
    <script src='https://code.responsivevoice.org/responsivevoice.js'></script>
    <script src="js/jquery.js"></script>
    
    <script type="text/javascript">
    var content = "";
        
    function download(strData, strFileName, strMimeType) {
        var D = document,
            A = arguments,
            a = D.createElement("a"),
            d = A[0],
            n = A[1],
            t = A[2] || "text/plain";

        //build download link:
        a.href = "data:" + strMimeType + "charset=utf-8," + escape(strData);


        if (window.MSBlobBuilder) { // IE10
            var bb = new MSBlobBuilder();
            bb.append(strData);
            return navigator.msSaveBlob(bb, strFileName);
        } /* end if(window.MSBlobBuilder) */



        if ('download' in a) { //FF20, CH19
            a.setAttribute("download", n);
            a.innerHTML = "downloading...";
            D.body.appendChild(a);
            setTimeout(function() {
                var e = D.createEvent("MouseEvents");
                e.initMouseEvent("click", true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
                a.dispatchEvent(e);
                D.body.removeChild(a);
            }, 66);
            content = "";
            return true;
        }; /* end if('download' in a) */



        //do iframe dataURL download: (older W3)
        var f = D.createElement("iframe");
        D.body.appendChild(f);
        f.src = "data:" + (A[2] ? A[2] : "application/octet-stream") + (window.btoa ? ";base64" : "") + "," + (window.btoa ? window.btoa : escape)(strData);
        setTimeout(function() {
            D.body.removeChild(f);
        }, 333);
        content = "";
        return true;
    }
        
        
    //var trainer = new LeapTrainer.HRController({hitThreshold: 0.9});
    var leapController = new Leap.Controller();    
    var trainer = new LeapTrainer.HRController({controller: leapController, minGestureFrames: 30, hitThreshold: 0.5});

    leapController.connect();
    
    console.log("Controller Hooked");
        
    var letter = "";
    trainer.on('training-started', function(movementName) {
        console.log('Started training for ' + movementName);
        $('#GestureSetup').popover('show');
        document.getElementsByClassName("navbar-inverse").backgroundColor = "#4c1a1a";
    });
    trainer.on('training-complete', function(movementName) {
        console.log('Completed training for ' + movementName);
        $('#GestureSetup').popover('hide');
        document.getElementsByClassName("navbar").color = "#222";
    });
    trainer.on('training-gesture-saved', function(movementName) {
        console.log('SAVED ' + movementName);
    });
    trainer.on('gesture-recognized', function(movementHit, movementName) {
        //console.log(movementHit);
        console.log(movementName);
        responsiveVoice.speak(movementName);
        sendDataPOST(movementName);
        content = content + movementName;
    });
    
    function sendDataPOST(gesture) {
        xhr = new XMLHttpRequest();
        var url = "https://stormy-tor-35371.herokuapp.com/";
        xh\r.open("POST", url, true);
        xhr.setRequestHeader("Content-type", "application/json");
        xhr.onreadystatechange = function () { 
        }
        var data = JSON.stringify({"signText":gesture.toString()});
        xhr.send(data);
    }
        
    </script>
    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">
    <!-- Custom CSS -->
    <style>
    body {
        padding-top: 70px;
        /* Required padding for .navbar-fixed-top. Remove if using .navbar-static-top. Change if height of navigation changes. */
    }
    </style>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>
    
    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">{AV}</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="#">Training</a>
                    </li>
                    <li>
                        <a href="#">SPEAK</a>
                    </li>

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Content -->
    <div class="container">

        <div class="row">
            <div class="col-lg-12 text-center">
                <h1>Comprehensive ASL Sign-to-Text Interface</h1>
                <p class="lead" style="margin-bottom:4%;">Speak with signs!</p>
            </div>
        </div>
        <!-- /.row -->
        <div class="row">
        <div class="col-xs-4">
            
        
            
        <ol padding-top="50px" class="list-group" id="GestureName">
            <li class="list-group-item">Enter Gesture Inputs Here </li>
        </ol>
            
        <ol padding-top="50px" class="list-group" id="GestureSetup" data-toggle="popover" title="Recording has begun" data-content="Record a sign now.">
            <li class="list-group-item">Record Gestures Here 
</li>
        </ol>
        <button type="button" class="btn btn-primary" id="addgesture" padding="50px">Add Gesture</button>
        <button type="button" class="btn btn-primary" id="vocalize" padding="50px" onclick="download(content, 'READ.txt', 'text/plain')">Vocalize</button>
        <script type="text/javascript">
        var count = 1;
        var currName = "Unnamed";
        var nesw = "";
        var iframe = document.createElement('iframe');
        iframe.className="col-xs-4";
        var html = '<body>Foo</body>';
        iframe.src = 'trainer-ui.html';
        iframe.width = 200;
        iframe.height = 400;
        document.body.appendChild(iframe);

        var size = -20;
        
            
        function helpMeSucceed(){
            trainer.create(currName);
        }    
            
        $( "#addgesture" ).click(function() {
            
            iframe.style.marginTop = size + "%";
          $("#GestureName").append('<li class="list-group-item">' + count + ' <input type="text" class="form-control" id="usr' + count + '"></li>'); 
        $("#usr" + count.toString()).on('keypress', function (e) {
                if (e.keyCode == 13) {
                    currName = $("#usr" + (count-1).toString()).val(); 
                    console.log("#usr" + (count-1).toString())
                    $("#GestureSetup").append('<li class="list-group-item">Gesture ' + currName + ' Waiting <button type="button" class="btn btn-success" padding="30px" onclick="helpMeSucceed()" id="recordGesture' + (count-1).toString() + '">Record</button></li>'); 
                    console.log('recordGesture' + (count-1).toString());
                    size = size - 10;
                }
            console.log(count);
            nesw = currName;
            });
        
        $('recordGesture' + (count-2).toString()).click(function() {
            console.log("hi");
            //$('recordGesture' + (count-2).toString()).value=$('recordGesture' + (count-1).toString()).value+" CAPTD";
            try {
            trainer.create(nesw);
            trainer.startTraining(nesw, 3);
            } catch(e){
                
            }
        });
            
        count++;
        });
            
        </script>
        </div>

        </div>

</div>
    <!-- /.container -->

    <!-- jQuery Version 1.11.1 -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

</body>

</html>
